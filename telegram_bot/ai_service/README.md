# Добавление базового функционала для психологического чат-бота

## Что было сделано:
1. Создан базовый функционал для работы с LLM через OpenRouter API:
   - Функция `get_llm_response()` для получения ответов от модели
   - Функция `initialize_dialogue()` для инициализации диалога с выбором проблемы
   - Функция `read_messages()` для чтения истории сообщений
   - Функция `chat()` для ведения диалога

2. Добавлены системные промпты для трех типов психологических проблем:
   - Депрессия
   - Профессиональное выгорание
   - Проблемы в отношениях

3. Настроена конфигурация для работы с OpenRouter API:
   - Добавлен config.json с API ключом
   - Использована модель google/gemma-3-4b-it:free

4. Добавлены демонстрационные файлы:
   - demo_dialogue.json для хранения истории диалога
   - Логирование основных этапов работы

## База данных SQLite

### Структура базы данных
База данных (dialogues.db) содержит две основные таблицы:

1. Таблица `dialogues`:
   - `id` (INTEGER PRIMARY KEY) - уникальный идентификатор диалога
   - `user_id` (TEXT) - идентификатор пользователя
   - `issue_id` (TEXT) - тип психологической проблемы
   - `timestamp` (DATETIME) - время создания записи
   - `dialogue_json` (TEXT) - JSON-строка с историей диалога

2. Таблица `book_recommendations`:
   - `id` (INTEGER PRIMARY KEY) - уникальный идентификатор рекомендации
   - `user_id` (TEXT) - идентификатор пользователя
   - `issue_id` (TEXT) - тип психологической проблемы
   - `timestamp` (DATETIME) - время создания записи
   - `recommendations_json` (TEXT) - JSON-строка с рекомендациями
   - `dialogue_id` (INTEGER) - внешний ключ на таблицу dialogues

### Функции для работы с БД
1. Инициализация и подключение:
   - `init_db()` - создание таблиц при первом запуске
   - `get_db_connection()` - получение соединения с БД

2. Работа с диалогами:
   - `log_dialogue(user_id, issue_id, dialogue)` - логирование диалога
   - `get_user_dialogues(user_id)` - получение всех диалогов пользователя
   - `get_dialogue_by_id(dialogue_id)` - получение конкретного диалога

3. Работа с рекомендациями:
   - `log_book_recommendations(user_id, issue_id, recommendations, dialogue_id)` - логирование рекомендаций
   - `get_user_recommendations(user_id)` - получение всех рекомендаций пользователя

### Логирование
Все операции с базой данных логируются с использованием модуля logging:
- Создание соединений
- Выполнение запросов
- Ошибки и предупреждения
- Успешные операции

## Технические детали:
- Использован OpenAI-совместимый API через OpenRouter
- Добавлена типизация для функций с использованием typing
- Реализовано логирование для отслеживания работы системы
- Структурированы промпты для разных сценариев консультирования
- SQLite для хранения данных с поддержкой JSON

## Как тестировать:
1. Убедиться в наличии config.json с валидным API ключом
    1.1 Если его нет, то создайте его. Пример в файле config_example.json
2. Запустить py telegram_bot/bot_main.py
3. Проверить корректность инициализации диалога и ответов модели
4. Проверить создание и работу базы данных:
   - Убедиться, что файл dialogues.db создан
   - Проверить логирование операций в консоли
   - Проверить сохранение диалогов и рекомендаций

Пример запроса для запуска в терминале:
```
pip install -r requirements.txt
```
```
py telegram_bot/bot_main.py
```

После выполнения команд в терминале отобразится ответ ИИ и логи операций с базой данных

## Следующие шаги:
- Добавить обработку ошибок
- Реализовать миграции базы данных
- Добавить индексы для оптимизации запросов
- Добавить больше сценариев консультирования
- Улучшить промпты на основе обратной связи

# Функционал рекомендации книг и ресурсов

## Что было добавлено:
1. Создан модуль ai_books.py для рекомендации книг и ресурсов:
   - Функция `get_book_recommendations()` для получения персонализированных рекомендаций
   - Функция `create_recommendation_prompt()` для создания промпта на основе диалога
   - Функция `format_recommendations()` для форматирования рекомендаций в читаемый вид
   - Функция `get_book_recommendations_from_file()` для тестирования на основе файла диалога

2. Рекомендации формируются на основе:
   - Типа психологической проблемы (депрессия, выгорание, проблемы в отношениях)
   - Контекста из последних сообщений пользователя
   - Научно обоснованных источников

3. Формат рекомендаций включает:
   - Книги (название, автор, описание, почему подходит)
   - Ресурсы (название, тип, описание, ссылка)

## Как тестировать:
1. Убедиться в наличии config.json с валидным API ключом
2. Запустить тестирование из корня проекта
```
py telegram_bot/bot_main.py
```